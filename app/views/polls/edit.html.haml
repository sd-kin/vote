= render 'edit_form', poll: @poll

%div[@poll, :links_for]
  = render 'links', poll: @poll

:javascript
  const addOptionFieldsButton = document.querySelector('#add-option');

  addOptionFieldsButton.addEventListener('click', renderOptionFields);

  function renderOptionFields() {
    $('#add-option').before("#{escape_javascript render 'poll_option_fields', option: @poll.options.build}")
  }

  function removeOptionsFields(btn){
    btn.parentElement.parentElement.parentElement.style.display = "none";

    const optionFieldsArray = Array.prototype.slice.call(document.querySelectorAll('.option-fields'))
    const optionFieldsCount = optionFieldsArray.reduce(countVisibleOptions,0);

    if( optionFieldsCount < 3 ) renderOptionFields();
  }

  function countVisibleOptions(counter, option) {
    if( option.style.display !== 'none' ) counter = counter+1;
    return counter;
  }
